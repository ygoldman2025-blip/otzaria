/// Mapping of Hebrew book abbreviations to their full names
/// Allows users to search using short forms like "שוע יוד" instead of "שולחן ערוך יורה דעה"
class BookAbbreviations {
  static const Map<String, String> abbreviations = {
    'רמ': 'משנה תורה',
    'רמב': 'משנה תורה',
    'רמבם': 'משנה תורה',
    'רמ"ם': 'משנה תורה',
    'רמ"ב': 'משנה תורה',
    'רמב"ם': 'משנה תורה',
    'משנה תורה': 'משנה תורה',
    'יד החזקה': 'משנה תורה',

    // Shulchan Aruch
    'שוע': 'שולחן ערוך',
    'שע': 'שולחן ערוך',
    'שולחן ערוך': 'שולחן ערוך',
    'סמע': 'שולחן ערוך',
    'סמ"ע': 'שולחן ערוך',

    // Shulchan Aruch - Sections (Oraim) - with full names as they appear in the system
    'אה': 'שולחן ערוך אורח חיים',
    'אורח חיים': 'שולחן ערוך אורח חיים',
    'או"ח': 'שולחן ערוך אורח חיים',
    'אוח': 'שולחן ערוך אורח חיים',
    'יד': 'שולחן ערוך יורה דעה',
    'יו': 'שולחן ערוך יורה דעה',
    'יוד': 'שולחן ערוך יורה דעה',
    'יו"ד': 'שולחן ערוך יורה דעה',
    'יודא': 'שולחן ערוך יורה דעה',
    'יורה דעה': 'שולחן ערוך יורה דעה',
    'אבהע': 'שולחן ערוך אבן העזר',
    'אבן העזר': 'שולחן ערוך אבן העזר',
    'אה': 'שולחן ערוך אבן העזר',
    'חם': 'שולחן ערוך חושן משפט',
    'חו"ם': 'שולחן ערוך חושן משפט',
    'חום': 'שולחן ערוך חושן משפט',
    'חושן משפט': 'שולחן ערוך חושן משפט',

    // Common combinations
    'שוע אה': 'שולחן ערוך אורח חיים',
    'שוע או"ח': 'שולחן ערוך אורח חיים',
    'שוע אוח': 'שולחן ערוך אורח חיים',
    'שוע יד': 'שולחן ערוך יורה דעה',
    'שוע יו': 'שולחן ערוך יורה דעה',
    'שוע יוד': 'שולחן ערוך יורה דעה',
    'שוע יו"ד': 'שולחן ערוך יורה דעה',
    'שוע יודא': 'שולחן ערוך יורה דעה',
    'שע יו': 'שולחן ערוך יורה דעה',
    'שע יוד': 'שולחן ערוך יורה דעה',
    'שע יו"ד': 'שולחן ערוך יורה דעה',
    'שוע אבהע': 'שולחן ערוך אבן העזר',
    'שוע חם': 'שולחן ערוך חושן משפט',
    'שוע חו"ם': 'שולחן ערוך חושן משפט',
    'שוע חום': 'שולחן ערוך חושן משפט',
    'שע חו"ם': 'שולחן ערוך חושן משפט',
    'שע חום': 'שולחן ערוך חושן משפט',

    // Shulchan Aruch HaRav and Shulchan Aruch HaGra
    'שוע הרב': 'שולחן ערוך הרב',
    'שוע הגרא': 'שולחן ערוך הגרא',
    'שע"ה': 'שולחן ערוך הרב',

    // Talmud - Main references
    'בבלי': 'תלמוד בבלי',
    'ירושלמי': 'תלמוד ירושלמי',
    'ירוש': 'תלמוד ירושלמי',

    // Masechtas (Talmudic Tractates) - Seder Zeraim
    'ברכות': 'ברכות',
    'בר': 'ברכות',
    'פאה': 'פאה',
    'דמאי': 'דמאי',
    'קדשים': 'קדשים',
    'שביעית': 'שביעית',
    'שב': 'שביעית',
    'תרומות': 'תרומות',
    'תר': 'תרומות',
    'מעשרות': 'מעשרות',
    'מעש': 'מעשרות',
    'מעשר שני': 'מעשר שני',
    'חלה': 'חלה',
    'בכורים': 'בכורים',
    'בכ': 'בכורים',

    // Masechtas - Seder Moed
    'שבת': 'שבת',
    'ש"ת': 'שבת',
    'ערובין': 'ערובין',
    'ע"ב': 'ערובין',
    'פסחים': 'פסחים',
    'פס': 'פסחים',
    'שקלים': 'שקלים',
    'שקל': 'שקלים',
    'יומא': 'יומא',
    'סוכה': 'סוכה',
    'סוכות': 'סוכה',
    'בציצות': 'בציצות',
    'ביצה': 'ביצה',
    'ב"ח': 'ביצה',
    'תגוונין': 'תגוונין',
    'תגו': 'תגוונין',
    'ראש השנה': 'ראש השנה',
    'ר"ה': 'ראש השנה',
    'תעניות': 'תעניות',
    'תע': 'תעניות',
    'מגילה': 'מגילה',
    'מג': 'מגילה',
    'מועד קטן': 'מועד קטן',
    'ח"מ': 'מועד קטן',
    'חגיגה': 'חגיגה',
    'חג': 'חגיגה',

    // Masechtas - Seder Nashim
    'יבמות': 'יבמות',
    'יב': 'יבמות',
    'כתובות': 'כתובות',
    'כתו': 'כתובות',
    'קידושין': 'קידושין',
    'קיד': 'קידושין',
    'גיטין': 'גיטין',
    'גיט': 'גיטין',
    'סוטה': 'סוטה',
    'סו': 'סוטה',
    'נדרים': 'נדרים',
    'נד': 'נדרים',
    'נזיר': 'נזיר',
    'נז': 'נזיר',

    // Masechtas - Seder Nezikin
    'בבא קמא': 'בבא קמא',
    'בק': 'בבא קמא',
    'בבא מציעא': 'בבא מציעא',
    'במ': 'בבא מציעא',
    'בבא בתרא': 'בבא בתרא',
    'בב': 'בבא בתרא',
    'סנהדרין': 'סנהדרין',
    'סנ': 'סנהדרין',
    'מכות': 'מכות',
    'מכ': 'מכות',
    'שבועות': 'שבועות',
    'שבו': 'שבועות',
    'עדויות': 'עדויות',
    'עד': 'עדויות',
    'עבודה זרה': 'עבודה זרה',
    'ע"ז': 'עבודה זרה',
    'אבות': 'אבות',
    'אב': 'אבות',
    'אבות דרבי נתן': 'אבות דרבי נתן',
    'אדרן': 'אבות דרבי נתן',

    // Masechtas - Seder Kodashim
    'זבחים': 'זבחים',
    'זב': 'זבחים',
    'מנחות': 'מנחות',
    'מנ': 'מנחות',
    'חולין': 'חולין',
    'חול': 'חולין',
    'בכורות': 'בכורות',
    'בכ': 'בכורות',
    'ערכין': 'ערכין',
    'ערך': 'ערכין',
    'תמורה': 'תמורה',
    'תמ': 'תמורה',
    'קריתות': 'קריתות',
    'קר': 'קריתות',
    'מעילה': 'מעילה',
    'מעיל': 'מעילה',
    'תמיד': 'תמיד',
    'מדות': 'מדות',
    'מדו': 'מדות',
    'קינים': 'קינים',
    'קי': 'קינים',

    // Masechtas - Seder Tahorot
    'כלים': 'כלים',
    'כל': 'כלים',
    'אהלות': 'אהלות',
    'אהל': 'אהלות',
    'נגעים': 'נגעים',
    'נגע': 'נגעים',
    'פרה': 'פרה',
    'פר': 'פרה',
    'טהרות': 'טהרות',
    'טהרו': 'טהרות',
    'מיקואות': 'מיקואות',
    'מקו': 'מיקואות',
    'נידה': 'נידה',
    'נ"י': 'נידה',
    'ידיים': 'ידיים',
    'יד': 'ידיים',
    'אוכלין': 'אוכלין',
    'אוכ': 'אוכלין',
    'זבים': 'זבים',
    'זב': 'זבים',
    'טבול יום': 'טבול יום',
    'טבול': 'טבול יום',
    'יד אחרונה': 'יד אחרונה',
    'יד אחרו': 'יד אחרונה',

    // Rishonim (Early Jewish Scholars)
    'רש"י': 'רשי',
    'רשי': 'רשי',
    'רבנו חננאל': 'רבנו חננאל',
    'ר"ח': 'רבנו חננאל',
    'גר"א': 'גר"א',
    'גרא': 'גר"א',
    'בעל התוספות': 'בעל התוספות',
    'תוס': 'תוספות',
    'תוספות': 'תוספות',
    'ר"י': 'ר"י מברולי',
    'ר"ן': 'ר"ן נחמני',
    'מיימוני': 'מיימוני',
    'ראב"ד': 'ראב"ד',
    'רבד': 'ראב"ד',
    'ראבע': 'אבן עזרא',
    'אבן עזרא': 'אבן עזרא',
    'ר"ב': 'רבינו בחיי',
    'רבינו בחיי': 'רבינו בחיי',
    'רבי': 'רבי יהודה הנשיא',
    'טור': 'ארבעה טורים',
    'טוריא': 'ארבעה טורים',
    'בית יוסף': 'בית יוסף',
    'בי"י': 'בית יוסף',

    // Achronim (Later Jewish Scholars)
    'חתם סופר': 'חתם סופר',
    'חתס': 'חתם סופר',
    'שלום בײַיתכם': 'שלום בײַיתכם',
    'מהרשא': 'מהרשא',
    'מהר"ם': 'מהר"ם',
    'פני יהושע': 'פני יהושע',
    'פ"י': 'פני יהושע',
    'ערוך השולחן': 'ערוך השולחן',
    'ערהש': 'ערוך השולחן',
    'קצות החושן': 'קצות החושן',
    'קצה"ח': 'קצות החושן',
    'מגן אברהם': 'מגן אברהם',
    'מג"א': 'מגן אברהם',
    'משנה ברורה': 'משנה ברורה',
    'מש"ב': 'משנה ברורה',
    'מב': 'משנה ברורה',
    'פתחי תשובה': 'פתחי תשובה',
    'פתח': 'פתחי תשובה',
    'חפץ חיים': 'חפץ חיים',
    'חח': 'חפץ חיים',
    'עיון יעקב': 'עיון יעקב',
    'ע"י': 'עיון יעקב',
    'זכר צדיק': 'זכר צדיק',
    'בנות ישראל': 'בנות ישראל',

    // Page/Daf notation - support "ב ב" format
    // This allows searching for daffim with space separator instead of colon

    // Torah / Tanakh
    'בראשית': 'בראשית',
    'בר': 'בראשית',
    'שמות': 'שמות',
    'שם': 'שמות',
    'ויקרא': 'ויקרא',
    'ויק': 'ויקרא',
    'במדבר': 'במדבר',
    'במ': 'במדבר',
    'דברים': 'דברים',
    'דב': 'דברים',

    // Tanakh books
    'ישעיה': 'ישעיה',
    'ירמיה': 'ירמיה',
    'יחזקאל': 'יחזקאל',
    'הושע': 'הושע',
    'יואל': 'יואל',
    'עמוס': 'עמוס',
    'עובדיה': 'עובדיה',
    'יונה': 'יונה',
    'מיכה': 'מיכה',
    'נחום': 'נחום',
    'חבקוק': 'חבקוק',
    'צפניה': 'צפניה',
    'חגי': 'חגי',
    'זכריה': 'זכריה',
    'מלאכי': 'מלאכי',
    'תהילים': 'תהילים',
    'איוב': 'איוב',
    'משלי': 'משלי',
    'רות': 'רות',
    'שיר השירים': 'שיר השירים',
    'קהלת': 'קהלת',
    'איכה': 'איכה',
    'אסתר': 'אסתר',
    'דניאל': 'דניאל',
    'עזרא': 'עזרא',
    'נחמיה': 'נחמיה',
    'דברי הימים א': 'דברי הימים א',
    'דברי הימים ב': 'דברי הימים ב',

    // Commentaries
    'רש"י': 'רשי',
    'רשי': 'רשי',
    'תוס': 'תוספות',
    'תוספות': 'תוספות',
    'ר"ן': 'ר"ן',
    'ר"י': 'ר"י',

    // Kabbala
    'זוהר': 'זוהר',
    'עץ חיים': 'עץ חיים',

    // Midrash
    'מדרש': 'מדרש',
    'מדרש רבה': 'מדרש רבה',
    'יל"ק': 'יל"ק',
  };

  /// Expands abbreviations in the search query
  /// Returns expanded query with abbreviations replaced by full names
  /// Also converts daffim notation (e.g., "ב ב" or "א א") to standard format with colon
  static String expandAbbreviations(String query) {
    if (query.isEmpty) return query;

    var result = query;

    // First, convert daffim notation from "ב ב" format to "ב:" format
    // This regex finds Hebrew letter + space + Hebrew letter pattern
    // and converts it to the daf format with colon
    final daffimPattern = RegExp(
      r'(^|\s)([א-ת])\s+([א-ת])(\s|$)',
      multiLine: true,
    );
    
    result = result.replaceAllMapped(daffimPattern, (match) {
      final prefix = match.group(1) ?? '';
      final firstLetter = match.group(2) ?? '';
      final secondLetter = match.group(3) ?? '';
      final suffix = match.group(4) ?? '';
      // Keep in searchable format - could be "ב ב" or "ב:" depending on system
      return '$prefix$firstLetter:$secondLetter$suffix';
    });

    // Sort by length descending to replace longer abbreviations first
    final sortedAbbr = abbreviations.entries.toList()
      ..sort((a, b) => b.key.length.compareTo(a.key.length));

    for (final entry in sortedAbbr) {
      final abbreviation = entry.key;
      final fullName = entry.value;

      // Word boundary replacement - only replace whole words
      final pattern = RegExp(
        r'(^|\s)' + RegExp.escape(abbreviation) + r'(\s|$)',
        caseSensitive: false,
      );

      result = result.replaceAll(pattern, (match) {
        final prefix = match.group(1) ?? '';
        final suffix = match.group(2) ?? '';
        return '$prefix$fullName$suffix';
      });
    }

    return result;
  }

  /// Gets abbreviations for a specific book name
  /// Useful for showing suggestions to users
  static List<String> getAbbreviationsFor(String bookName) {
    final normalized = bookName.trim().toLowerCase();
    return abbreviations.entries
        .where((entry) => entry.value.toLowerCase().contains(normalized))
        .map((entry) => entry.key)
        .toList();
  }
}
